
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Build and Flash the Firmware &#8212; ODRI Firmware for uDriver Boards 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Motor Alignment Calibration" href="motor_alignment.html" />
    <link rel="prev" title="ODRI Firmware for uDriver Boards" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">ODRI Firmware for uDriver Boards</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Build &amp; Flash</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-the-code">Get the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-motorware">Get MotorWare</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-code-composer-studio">Install Code Composer Studio</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-instructions">Build Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-in-code-composer-studio">Import in Code Composer Studio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run-in-debug-mode">Build and Run in Debug Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-write-to-flash">Build and Write to Flash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launchpad-boot-switches">LaunchPad Boot Switches</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="motor_alignment.html">Motor Alignment Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="program_structure_and_frequencies.html">Program Structure &amp; Frequencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="can/index.html">CAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi/index.html">SPI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">ODRI Firmware for uDriver Boards</a></li>
      <li>Next: <a href="motor_alignment.html" title="next chapter">Motor Alignment Calibration</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="how-to-build-and-flash-the-firmware">
<h1>How to Build and Flash the Firmware<a class="headerlink" href="#how-to-build-and-flash-the-firmware" title="Permalink to this heading">¶</a></h1>
<section id="get-the-code">
<h2>Get the Code<a class="headerlink" href="#get-the-code" title="Permalink to this heading">¶</a></h2>
<p>Simply clone the firmware repository (including submodules):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone --recursive https://github.com/open-dynamic-robot-initiative/udriver_firmware.git
</pre></div>
</div>
<p>The default configuration is assuming the <em>Antigravity 4004 300kv</em> motors.  In
case you are using different motors, change the <code class="docutils literal notranslate"><span class="pre">config_f28069m_drv8305</span></code>
submodule to the appropriate branch.</p>
</section>
<section id="get-motorware">
<h2>Get MotorWare<a class="headerlink" href="#get-motorware" title="Permalink to this heading">¶</a></h2>
<p>Our software is based on Texas Instruments’ <a class="reference external" href="https://www.ti.com/tool/MOTORWARE">MotorWare</a> library which can be
downloaded from their website.  We made some modifications to the original
MotorWare which are needed to build our software.
We provide patch files <code class="docutils literal notranslate"><span class="pre">motorware_1_01_00_18_patch</span></code> with these changes, they
are included in the directories <code class="docutils literal notranslate"><span class="pre">firmware_can</span></code>/<code class="docutils literal notranslate"><span class="pre">firmware_spi</span></code> (note that
they differ for the two firmware versions.</p>
<p>Use the following steps to set up MotorWare for the project:</p>
<ol class="arabic">
<li><p>Download MotorWare v1.01.00.18 from the <a class="reference external" href="https://www.ti.com/tool/MOTORWARE">MotorWare</a> website.</p></li>
<li><p>Install it to extract the source.  For Linux users: Unfortunately TI only
provides a Windows installer.  There is not really an installation required,
you only need the source files.  You can get them by either installing on a
Windows machine or using an emulator like Wine on Linux and then copy the
files from the installation directory.
Search for the directory containing the <code class="docutils literal notranslate"><span class="pre">sw</span></code> directory and copy it into
the directory <code class="docutils literal notranslate"><span class="pre">firmware_X/motorware</span></code> (where <code class="docutils literal notranslate"><span class="pre">X</span></code> is either “can” or “spi”,
depending on which version you want to use).  The structure should be like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>udriver_firmware/firmware
├── amd_motorware_ext
├── config_f28069m_drv8305
└── firmware_X
    ├── motorware                &lt;-- Add motorware here
    │   ├── docs
    │   ├── eclipse
    │   ├── mw_explorer
    │   └── sw
    └── mw_dual_motor_torque_ctrl
</pre></div>
</div>
</li>
<li><p>Finally go into the <code class="docutils literal notranslate"><span class="pre">motorware</span></code> directory and apply the patch file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ patch -p1 &lt; ../motorware_1_01_00_18.patch
</pre></div>
</div>
</li>
</ol>
</section>
<section id="install-code-composer-studio">
<h2>Install Code Composer Studio<a class="headerlink" href="#install-code-composer-studio" title="Permalink to this heading">¶</a></h2>
<p>To build the firmware and to flash it to the boards, you need Texas Instruments’
<a class="reference external" href="http://www.ti.com/tool/ccstudio">Code Composer Studio</a> (CCS).  These instructions are tested with version
9.1.0 but other versions may work as well.</p>
<p>When installing it, make sure the following components are selected:</p>
<ul class="simple">
<li><p><strong>Processor Support</strong>: C2000 32-bit Real-time MCUs</p></li>
<li><p><strong>Debug Probes</strong>: TI XDS (this only needs to be selected explicitly in older
versions of CCS)</p></li>
</ul>
<p>When starting CCS for the first time, you have to specify a workspace location.
Note that this “CCS workspace” is just where CCS stores its configuration and
is not related to the location of the source code (i.e. the CCS workspace and
the location of the firmware source code should be in different directories).</p>
</section>
<section id="build-instructions">
<h2>Build Instructions<a class="headerlink" href="#build-instructions" title="Permalink to this heading">¶</a></h2>
<section id="import-in-code-composer-studio">
<h3>Import in Code Composer Studio<a class="headerlink" href="#import-in-code-composer-studio" title="Permalink to this heading">¶</a></h3>
<p>Start Code Composer Studio and import the <code class="docutils literal notranslate"><span class="pre">mw_dual_motor_torque_ctrl</span></code> project
via the menu</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Project</span> <span class="o">&gt;</span> <span class="n">Import</span> <span class="n">CCS</span> <span class="n">Projects</span><span class="o">...</span>
</pre></div>
</div>
<p>In the import dialogue, set the search-directory to the one of the
<code class="docutils literal notranslate"><span class="pre">mw_dual_motor_torque_ctrl</span></code> package. The Discovered projects pane should then
show <code class="docutils literal notranslate"><span class="pre">dual_motor_torque_ctrl_X</span></code> (X = “can” or “spi”).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure the “Copy projects into workspace” option is <strong>not</strong> set.</p>
</div>
<p>After importing, the project should show up in the <em>Project Explorer</em>.</p>
</section>
<section id="build-and-run-in-debug-mode">
<h3>Build and Run in Debug Mode<a class="headerlink" href="#build-and-run-in-debug-mode" title="Permalink to this heading">¶</a></h3>
<p>You can run the firmware in debug mode while the board is connected to the
computer via USB.  This is mostly useful for development.</p>
<p>Note: When using a TI LaunchPad board, make sure the boot switches are set such
that jTag is enabled (see [below](#launchpad-boot-switches)).</p>
<ol class="arabic simple">
<li><p>Compile your code, using the “Release” build.</p></li>
<li><p>Make sure the board is powered and connected via USB to the PC. All three
boot switche have to be in the upper position (see below).</p></li>
<li><p>Start the Debugger by clicking on the bug icon in the tool bar: <img alt="CCS debug button" src="_images/ccs_button_debug.png" /></p></li>
<li><p>Enable Silicon Real-time Mode by clicking the corresponding button in the
tool bar: <img alt="CCS realtime mode button" src="_images/ccs_button_silicon_realtime_mode.png" /></p></li>
<li><p>Run the code by pressing the Resume button: <img alt="CCS resume button" src="_images/ccs_button_resume.png" />
Now you can use a GUIComposer GUI or modify variables on the board via the
<em>Expressions View</em>.</p></li>
<li><p>To quit the debugger, press the Terminate button: <img alt="CCS terminate button" src="_images/ccs_button_terminate.png" />
Note: This will only detach the debugger, it will not stop the program on the
board!</p></li>
</ol>
<p>With this procedure, the program is not permanently stored on the board. That
means all steps have to be repeated, everytime the board is restarted.</p>
</section>
<section id="build-and-write-to-flash">
<h3>Build and Write to Flash<a class="headerlink" href="#build-and-write-to-flash" title="Permalink to this heading">¶</a></h3>
<p>To have the program written to flash rather than RAM (so that it is permanently
stored on the board), simply switch the build type from “Release” to “Flash”.</p>
<p>Now compile and write the program to the board by running the debugger (same
procedure like described above, only use “Flash” instead of “Release” build).
You can use the debugger to run and monitor the program just like before.</p>
<p>Note that when using the TI LaunchPad, you have to set the boot switches on the
board to the right configuration so that the firmware is automatically loaded
from flash when restarting the board (see next section).</p>
</section>
<section id="launchpad-boot-switches">
<h3>LaunchPad Boot Switches<a class="headerlink" href="#launchpad-boot-switches" title="Permalink to this heading">¶</a></h3>
<p><em>This only applies to the TI LaunchPad board.</em></p>
<p>After the program is written to the flash memory with the steps described above,
the boot settings have to be changed to tell the board to run the code in the
flash rather than using the USB connection.</p>
<p>Change the switches on the board (hidden under the J1 BoosterPack…) to 1: Up,
2: Up, 3: Down.</p>
<p>Now the board should automatically run the program from flash when powered. Note
that connection via USB is not possible in this configuration (i.e. to use the
debugger or update the program you have to set the switches back to Up/Up/Up
again).</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Run firmware from flash</p></td>
<td><p>Use jTag (to debug via USB)</p></td>
</tr>
<tr class="row-even"><td><img alt="LaunchPad boot switch configuration ON - ON - OFF" src="_images/launchpad_bootswitches_boot_from_flash.png" />
</td>
<td><img alt="LaunchPad boot switch configuration ON - ON - ON" src="_images/launchpad_bootswitches_use_jtag.png" />
</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021, Max Planck Gesellschaft.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/build_instructions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>